{% extends 'base.html' %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl p-8 mb-8 text-white">
        <h1 class="text-3xl font-bold mb-2">⚙️ Ayarlar</h1>
        <p class="text-purple-100">Hesap bilgilerinizi yönetin</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Sol Menu -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-xl shadow-lg p-6 sticky top-8">
                <nav class="space-y-2">
                    <a href="#profile" class="block px-4 py-3 rounded-lg bg-purple-50 text-purple-600 font-medium">
                        👤 Profil Bilgileri
                    </a>
                    <a href="#password" class="block px-4 py-3 rounded-lg hover:bg-gray-50 text-gray-700">
                        🔒 Şifre Değiştir
                    </a>
                    <a href="#delete" class="block px-4 py-3 rounded-lg hover:bg-red-50 text-red-600">
                        🗑️ Hesabı Sil
                    </a>
                </nav>
            </div>
        </div>

        <!-- Sağ İçerik -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Profil Bilgileri -->
            <div id="profile" class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                    <span class="text-3xl mr-3">👤</span>
                    Profil Bilgileri
                </h2>
                
                <form method="POST" class="space-y-6">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="update_profile">
                    
                    <!-- Avatar Seçici -->
                    <div class="mb-6 border-2 border-purple-200 rounded-xl p-6 bg-purple-50">
                        <label class="block text-gray-700 font-bold mb-3 text-center text-lg">🎨 Avatarını Seç</label>
                        
                        <div class="flex justify-center mb-6">
                            <div class="w-24 h-24 rounded-full bg-gradient-to-br from-purple-400 to-blue-400 flex items-center justify-center text-6xl border-4 border-white shadow-lg" id="selected-avatar-preview">
                                {{ user.avatar|default:"🚀" }}
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-5 md:grid-cols-8 gap-2">
                            <!-- Uzay -->
                            <div class="avatar-option" data-avatar="🚀">🚀</div>
                            <div class="avatar-option" data-avatar="👨‍🚀">👨‍🚀</div>
                            <div class="avatar-option" data-avatar="👩‍🚀">👩‍🚀</div>
                            <div class="avatar-option" data-avatar="🛸">🛸</div>
                            <div class="avatar-option" data-avatar="🌟">🌟</div>
                            <div class="avatar-option" data-avatar="⭐">⭐</div>
                            <div class="avatar-option" data-avatar="🌙">🌙</div>
                            <div class="avatar-option" data-avatar="🪐">🪐</div>
                            
                            <!-- Hayvanlar -->
                            <div class="avatar-option" data-avatar="🦊">🦊</div>
                            <div class="avatar-option" data-avatar="🐼">🐼</div>
                            <div class="avatar-option" data-avatar="🐨">🐨</div>
                            <div class="avatar-option" data-avatar="🐯">🐯</div>
                            <div class="avatar-option" data-avatar="🦁">🦁</div>
                            <div class="avatar-option" data-avatar="🐸">🐸</div>
                            <div class="avatar-option" data-avatar="🐶">🐶</div>
                            <div class="avatar-option" data-avatar="🐱">🐱</div>
                            
                            <!-- Yiyecek -->
                            <div class="avatar-option" data-avatar="🍕">🍕</div>
                            <div class="avatar-option" data-avatar="🍔">🍔</div>
                            <div class="avatar-option" data-avatar="🍦">🍦</div>
                            <div class="avatar-option" data-avatar="🍩">🍩</div>
                            <div class="avatar-option" data-avatar="🍪">🍪</div>
                            <div class="avatar-option" data-avatar="🎂">🎂</div>
                            <div class="avatar-option" data-avatar="🍉">🍉</div>
                            <div class="avatar-option" data-avatar="🍓">🍓</div>
                            
                            <!-- Spor -->
                            <div class="avatar-option" data-avatar="⚽">⚽</div>
                            <div class="avatar-option" data-avatar="🏀">🏀</div>
                            <div class="avatar-option" data-avatar="🎮">🎮</div>
                            <div class="avatar-option" data-avatar="🎨">🎨</div>
                            <div class="avatar-option" data-avatar="🎸">🎸</div>
                            <div class="avatar-option" data-avatar="🎯">🎯</div>
                            <div class="avatar-option" data-avatar="🎲">🎲</div>
                            <div class="avatar-option" data-avatar="🎹">🎹</div>
                            
                            <!-- Doğa -->
                            <div class="avatar-option" data-avatar="🌸">🌸</div>
                            <div class="avatar-option" data-avatar="🌺">🌺</div>
                            <div class="avatar-option" data-avatar="🌻">🌻</div>
                            <div class="avatar-option" data-avatar="🌹">🌹</div>
                            <div class="avatar-option" data-avatar="🍀">🍀</div>
                            <div class="avatar-option" data-avatar="🌈">🌈</div>
                            <div class="avatar-option" data-avatar="⚡">⚡</div>
                            <div class="avatar-option" data-avatar="🔥">🔥</div>
                            
                            <!-- Teknoloji -->
                            <div class="avatar-option" data-avatar="💻">💻</div>
                            <div class="avatar-option" data-avatar="📱">📱</div>
                            <div class="avatar-option" data-avatar="🤖">🤖</div>
                            <div class="avatar-option" data-avatar="👾">👾</div>
                            <div class="avatar-option" data-avatar="🎧">🎧</div>
                            <div class="avatar-option" data-avatar="📷">📷</div>
                            <div class="avatar-option" data-avatar="🔬">🔬</div>
                            <div class="avatar-option" data-avatar="🔭">🔭</div>
                        </div>
                        
                        <input type="hidden" name="avatar" id="avatar-input" value="{{ user.avatar|default:'🚀' }}">
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Kullanıcı Adı</label>
                        <input type="text" name="username" value="{{ user.username }}" required
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition">
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">E-posta</label>
                        <input type="email" name="email" value="{{ user.email }}"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition">
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Doğum Tarihi</label>
                        <input type="date" name="birth_date" value="{{ user.birth_date|date:'Y-m-d' }}"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition">
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Rol</label>
                        <input type="text" value="{{ user.get_role_display }}" disabled
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-100 text-gray-600">
                        <p class="text-sm text-gray-500 mt-1">Rol değiştirilemez</p>
                    </div>

                    <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg font-bold hover:bg-purple-700 transition">
                        💾 Değişiklikleri Kaydet
                    </button>
                </form>
            </div>

            <!-- Şifre Değiştir -->
            <div id="password" class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                    <span class="text-3xl mr-3">🔒</span>
                    Şifre Değiştir
                </h2>
                
                <form method="POST" class="space-y-6">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="change_password">
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Mevcut Şifre</label>
                        <input type="password" name="old_password" required
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition">
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Yeni Şifre</label>
                        <input type="password" name="new_password" required minlength="6"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition">
                        <p class="text-sm text-gray-500 mt-1">En az 6 karakter</p>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Yeni Şifre (Tekrar)</label>
                        <input type="password" name="confirm_password" required minlength="6"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition">
                    </div>

                    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition">
                        🔑 Şifreyi Değiştir
                    </button>
                </form>
            </div>

            <!-- Hesabı Sil -->
            <div id="delete" class="bg-white rounded-xl shadow-lg p-8 border-2 border-red-200">
                <h2 class="text-2xl font-bold mb-4 text-red-600 flex items-center">
                    <span class="text-3xl mr-3">⚠️</span>
                    Tehlikeli Bölge
                </h2>
                
                <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                    <p class="text-red-700 font-medium">
                        ⚠️ Hesabınızı sildiğinizde tüm verileriniz kalıcı olarak silinecektir!
                    </p>
                    <ul class="mt-2 text-sm text-red-600 list-disc list-inside space-y-1">
                        <li>Tüm quiz sonuçlarınız</li>
                        <li>Kazandığınız rozetler</li>
                        <li>Puanlarınız ve seviye bilginiz</li>
                        <li>Profil bilgileriniz</li>
                    </ul>
                </div>

                <form method="POST" onsubmit="return confirm('Hesabınızı silmek istediğinizden emin misiniz? Bu işlem geri alınamaz!');">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="delete_account">
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 font-medium mb-2">Onaylamak için şifrenizi girin</label>
                        <input type="password" name="password" required
                            class="w-full px-4 py-3 border-2 border-red-300 rounded-lg focus:border-red-500 focus:outline-none transition">
                    </div>

                    <button type="submit" class="w-full bg-red-600 text-white py-3 rounded-lg font-bold hover:bg-red-700 transition">
                        🗑️ Hesabı Kalıcı Olarak Sil
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Geri Dön -->
    <div class="text-center mt-8">
        <a href="{% url 'dashboard' %}" class="inline-block bg-gray-200 text-gray-700 px-8 py-3 rounded-lg font-medium hover:bg-gray-300 transition">
            ← Dashboard'a Dön
        </a>
    </div>
</div>

<style>
.avatar-option {
    font-size: 2rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 0.5rem;
    border: 2px solid transparent;
    transition: all 0.2s ease;
    text-align: center;
    background: white;
}

.avatar-option:hover {
    transform: scale(1.15);
    border-color: #a78bfa;
    background: rgba(139, 92, 246, 0.1);
}

.avatar-option.selected {
    border-color: #8b5cf6;
    background: rgba(139, 92, 246, 0.25);
    transform: scale(1.1);
    box-shadow: 0 0 15px rgba(139, 92, 246, 0.4);
}
</style>

<script>
// Avatar seçimi
const avatarOptions = document.querySelectorAll('.avatar-option');
const avatarInput = document.getElementById('avatar-input');
const avatarPreview = document.getElementById('selected-avatar-preview');
const currentAvatar = '{{ user.avatar|default:"🚀" }}';

// Mevcut avatarı seçili göster
avatarOptions.forEach(option => {
    if (option.dataset.avatar === currentAvatar) {
        option.classList.add('selected');
    }
    
    option.addEventListener('click', function() {
        // Tüm seçimleri kaldır
        avatarOptions.forEach(opt => opt.classList.remove('selected'));
        
        // Yeni seçimi işaretle
        this.classList.add('selected');
        
        // Değeri güncelle
        const selectedAvatar = this.dataset.avatar;
        avatarInput.value = selectedAvatar;
        avatarPreview.textContent = selectedAvatar;
    });
});
</script>
{% endblock %}