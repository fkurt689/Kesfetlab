{% extends 'base.html' %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl p-8 mb-8 text-white">
        <h1 class="text-3xl font-bold mb-2">âš™ï¸ Ayarlar</h1>
        <p class="text-purple-100">Hesap bilgilerinizi yÃ¶netin</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Sol Menu -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-xl shadow-lg p-6 sticky top-8">
                <nav class="space-y-2">
                    <a href="#profile" class="block px-4 py-3 rounded-lg bg-purple-50 text-purple-600 font-medium">
                        ğŸ‘¤ Profil Bilgileri
                    </a>
                    <a href="#password" class="block px-4 py-3 rounded-lg hover:bg-gray-50 text-gray-700">
                        ğŸ”’ Åifre DeÄŸiÅŸtir
                    </a>
                    <a href="#delete" class="block px-4 py-3 rounded-lg hover:bg-red-50 text-red-600">
                        ğŸ—‘ï¸ HesabÄ± Sil
                    </a>
                </nav>
            </div>
        </div>

        <!-- SaÄŸ Ä°Ã§erik -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Profil Bilgileri -->
            <div id="profile" class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                    <span class="text-3xl mr-3">ğŸ‘¤</span>
                    Profil Bilgileri
                </h2>
                
                <form method="POST" class="space-y-6">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="update_profile">
                    
                    <!-- Avatar SeÃ§ici -->
                    <div class="mb-6 border-2 border-purple-200 rounded-xl p-6 bg-purple-50">
                        <label class="block text-gray-700 font-bold mb-3 text-center text-lg">ğŸ¨ AvatarÄ±nÄ± SeÃ§</label>
                        
                        <div class="flex justify-center mb-6">
                            <div class="w-24 h-24 rounded-full bg-gradient-to-br from-purple-400 to-blue-400 flex items-center justify-center text-6xl border-4 border-white shadow-lg" id="selected-avatar-preview">
                                {{ user.avatar|default:"ğŸš€" }}
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-5 md:grid-cols-8 gap-2">
                            <!-- Uzay -->
                            <div class="avatar-option" data-avatar="ğŸš€">ğŸš€</div>
                            <div class="avatar-option" data-avatar="ğŸ‘¨â€ğŸš€">ğŸ‘¨â€ğŸš€</div>
                            <div class="avatar-option" data-avatar="ğŸ‘©â€ğŸš€">ğŸ‘©â€ğŸš€</div>
                            <div class="avatar-option" data-avatar="ğŸ›¸">ğŸ›¸</div>
                            <div class="avatar-option" data-avatar="ğŸŒŸ">ğŸŒŸ</div>
                            <div class="avatar-option" data-avatar="â­">â­</div>
                            <div class="avatar-option" data-avatar="ğŸŒ™">ğŸŒ™</div>
                            <div class="avatar-option" data-avatar="ğŸª">ğŸª</div>
                            
                            <!-- Hayvanlar -->
                            <div class="avatar-option" data-avatar="ğŸ¦Š">ğŸ¦Š</div>
                            <div class="avatar-option" data-avatar="ğŸ¼">ğŸ¼</div>
                            <div class="avatar-option" data-avatar="ğŸ¨">ğŸ¨</div>
                            <div class="avatar-option" data-avatar="ğŸ¯">ğŸ¯</div>
                            <div class="avatar-option" data-avatar="ğŸ¦">ğŸ¦</div>
                            <div class="avatar-option" data-avatar="ğŸ¸">ğŸ¸</div>
                            <div class="avatar-option" data-avatar="ğŸ¶">ğŸ¶</div>
                            <div class="avatar-option" data-avatar="ğŸ±">ğŸ±</div>
                            
                            <!-- Yiyecek -->
                            <div class="avatar-option" data-avatar="ğŸ•">ğŸ•</div>
                            <div class="avatar-option" data-avatar="ğŸ”">ğŸ”</div>
                            <div class="avatar-option" data-avatar="ğŸ¦">ğŸ¦</div>
                            <div class="avatar-option" data-avatar="ğŸ©">ğŸ©</div>
                            <div class="avatar-option" data-avatar="ğŸª">ğŸª</div>
                            <div class="avatar-option" data-avatar="ğŸ‚">ğŸ‚</div>
                            <div class="avatar-option" data-avatar="ğŸ‰">ğŸ‰</div>
                            <div class="avatar-option" data-avatar="ğŸ“">ğŸ“</div>
                            
                            <!-- Spor -->
                            <div class="avatar-option" data-avatar="âš½">âš½</div>
                            <div class="avatar-option" data-avatar="ğŸ€">ğŸ€</div>
                            <div class="avatar-option" data-avatar="ğŸ®">ğŸ®</div>
                            <div class="avatar-option" data-avatar="ğŸ¨">ğŸ¨</div>
                            <div class="avatar-option" data-avatar="ğŸ¸">ğŸ¸</div>
                            <div class="avatar-option" data-avatar="ğŸ¯">ğŸ¯</div>
                            <div class="avatar-option" data-avatar="ğŸ²">ğŸ²</div>
                            <div class="avatar-option" data-avatar="ğŸ¹">ğŸ¹</div>
                            
                            <!-- DoÄŸa -->
                            <div class="avatar-option" data-avatar="ğŸŒ¸">ğŸŒ¸</div>
                            <div class="avatar-option" data-avatar="ğŸŒº">ğŸŒº</div>
                            <div class="avatar-option" data-avatar="ğŸŒ»">ğŸŒ»</div>
                            <div class="avatar-option" data-avatar="ğŸŒ¹">ğŸŒ¹</div>
                            <div class="avatar-option" data-avatar="ğŸ€">ğŸ€</div>
                            <div class="avatar-option" data-avatar="ğŸŒˆ">ğŸŒˆ</div>
                            <div class="avatar-option" data-avatar="âš¡">âš¡</div>
                            <div class="avatar-option" data-avatar="ğŸ”¥">ğŸ”¥</div>
                            
                            <!-- Teknoloji -->
                            <div class="avatar-option" data-avatar="ğŸ’»">ğŸ’»</div>
                            <div class="avatar-option" data-avatar="ğŸ“±">ğŸ“±</div>
                            <div class="avatar-option" data-avatar="ğŸ¤–">ğŸ¤–</div>
                            <div class="avatar-option" data-avatar="ğŸ‘¾">ğŸ‘¾</div>
                            <div class="avatar-option" data-avatar="ğŸ§">ğŸ§</div>
                            <div class="avatar-option" data-avatar="ğŸ“·">ğŸ“·</div>
                            <div class="avatar-option" data-avatar="ğŸ”¬">ğŸ”¬</div>
                            <div class="avatar-option" data-avatar="ğŸ”­">ğŸ”­</div>
                        </div>
                        
                        <input type="hidden" name="avatar" id="avatar-input" value="{{ user.avatar|default:'ğŸš€' }}">
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">KullanÄ±cÄ± AdÄ±</label>
                        <input type="text" name="username" value="{{ user.username }}" required
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition">
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">E-posta</label>
                        <input type="email" name="email" value="{{ user.email }}"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition">
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">DoÄŸum Tarihi</label>
                        <input type="date" name="birth_date" value="{{ user.birth_date|date:'Y-m-d' }}"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition">
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Rol</label>
                        <input type="text" value="{{ user.get_role_display }}" disabled
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-100 text-gray-600">
                        <p class="text-sm text-gray-500 mt-1">Rol deÄŸiÅŸtirilemez</p>
                    </div>

                    <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg font-bold hover:bg-purple-700 transition">
                        ğŸ’¾ DeÄŸiÅŸiklikleri Kaydet
                    </button>
                </form>
            </div>

            <!-- Åifre DeÄŸiÅŸtir -->
            <div id="password" class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                    <span class="text-3xl mr-3">ğŸ”’</span>
                    Åifre DeÄŸiÅŸtir
                </h2>
                
                <form method="POST" class="space-y-6">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="change_password">
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Mevcut Åifre</label>
                        <input type="password" name="old_password" required
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition">
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Yeni Åifre</label>
                        <input type="password" name="new_password" required minlength="6"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition">
                        <p class="text-sm text-gray-500 mt-1">En az 6 karakter</p>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Yeni Åifre (Tekrar)</label>
                        <input type="password" name="confirm_password" required minlength="6"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition">
                    </div>

                    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition">
                        ğŸ”‘ Åifreyi DeÄŸiÅŸtir
                    </button>
                </form>
            </div>

            <!-- HesabÄ± Sil -->
            <div id="delete" class="bg-white rounded-xl shadow-lg p-8 border-2 border-red-200">
                <h2 class="text-2xl font-bold mb-4 text-red-600 flex items-center">
                    <span class="text-3xl mr-3">âš ï¸</span>
                    Tehlikeli BÃ¶lge
                </h2>
                
                <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                    <p class="text-red-700 font-medium">
                        âš ï¸ HesabÄ±nÄ±zÄ± sildiÄŸinizde tÃ¼m verileriniz kalÄ±cÄ± olarak silinecektir!
                    </p>
                    <ul class="mt-2 text-sm text-red-600 list-disc list-inside space-y-1">
                        <li>TÃ¼m quiz sonuÃ§larÄ±nÄ±z</li>
                        <li>KazandÄ±ÄŸÄ±nÄ±z rozetler</li>
                        <li>PuanlarÄ±nÄ±z ve seviye bilginiz</li>
                        <li>Profil bilgileriniz</li>
                    </ul>
                </div>

                <form method="POST" onsubmit="return confirm('HesabÄ±nÄ±zÄ± silmek istediÄŸinizden emin misiniz? Bu iÅŸlem geri alÄ±namaz!');">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="delete_account">
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 font-medium mb-2">Onaylamak iÃ§in ÅŸifrenizi girin</label>
                        <input type="password" name="password" required
                            class="w-full px-4 py-3 border-2 border-red-300 rounded-lg focus:border-red-500 focus:outline-none transition">
                    </div>

                    <button type="submit" class="w-full bg-red-600 text-white py-3 rounded-lg font-bold hover:bg-red-700 transition">
                        ğŸ—‘ï¸ HesabÄ± KalÄ±cÄ± Olarak Sil
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Geri DÃ¶n -->
    <div class="text-center mt-8">
        <a href="{% url 'dashboard' %}" class="inline-block bg-gray-200 text-gray-700 px-8 py-3 rounded-lg font-medium hover:bg-gray-300 transition">
            â† Dashboard'a DÃ¶n
        </a>
    </div>
</div>

<style>
.avatar-option {
    font-size: 2rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 0.5rem;
    border: 2px solid transparent;
    transition: all 0.2s ease;
    text-align: center;
    background: white;
}

.avatar-option:hover {
    transform: scale(1.15);
    border-color: #a78bfa;
    background: rgba(139, 92, 246, 0.1);
}

.avatar-option.selected {
    border-color: #8b5cf6;
    background: rgba(139, 92, 246, 0.25);
    transform: scale(1.1);
    box-shadow: 0 0 15px rgba(139, 92, 246, 0.4);
}
</style>

<script>
// Avatar seÃ§imi
const avatarOptions = document.querySelectorAll('.avatar-option');
const avatarInput = document.getElementById('avatar-input');
const avatarPreview = document.getElementById('selected-avatar-preview');
const currentAvatar = '{{ user.avatar|default:"ğŸš€" }}';

// Mevcut avatarÄ± seÃ§ili gÃ¶ster
avatarOptions.forEach(option => {
    if (option.dataset.avatar === currentAvatar) {
        option.classList.add('selected');
    }
    
    option.addEventListener('click', function() {
        // TÃ¼m seÃ§imleri kaldÄ±r
        avatarOptions.forEach(opt => opt.classList.remove('selected'));
        
        // Yeni seÃ§imi iÅŸaretle
        this.classList.add('selected');
        
        // DeÄŸeri gÃ¼ncelle
        const selectedAvatar = this.dataset.avatar;
        avatarInput.value = selectedAvatar;
        avatarPreview.textContent = selectedAvatar;
    });
});
</script>
{% endblock %}